var request = require('request');
var cheerio = require('cheerio');
var path = require('path');
var async = require('async');
var _ = require('lodash');
var Bottleneck = require("bottleneck");
var geocoder = require('node-geocoder')('google', 'https', {apiKey: 'AIzaSyCxjI-adg-99L7QwUADOl18gH1ExT6VcYE'});
var urlBase = 'https://www.coursereport.com';
var search = '/schools?page='
var page = 1;

var locations = [ '2405 Robert Dedman Dr , Austin, TX 78705',
  'Wilmington',
  '683 Sutter St., San Francisco, CA 94108',
  'New York',
  'Nairobi',
  'Hyderabad, India',
  '100 Front St E, Toronto, ON M5A 1E1',
  '400 College Dr, Middleburg, FL 32068',
  'Milwaukee',
  '3558 Lee Road, Shaker Heights, OH 44120',
  'Santiago',
  'Sao Paulo',
  'Bogota',
  'Minneapolis',
  'San Francisco',
  'Berlin',
  'Provo',
  'Exmouth House 3-11 Pine Street, London,  EC1R 0JH',
  'Sydney',
  '100 Trade Center Road, Woburn, MA 01801',
  'Kattenburgerstraat 5, 1018 JA, Amsterdam,  ',
  '9401 James Ave S  #152, Bloomington, MN  55431',
  'Bali',
  'Canary Islands',
  'Pacific Coast, Ecuador',
  'New Brunswick',
  'the Refinery Nashville 438 Houston  St., Suite 263, Nashville, Tennessee 37203',
  'San Antonio',
  'London',
  'Sioux Falls',
  'Cluj Cowork, 23 Emil Isaac, Cluj,  ',
  'New York',
  'Denver',
  'Pound Hill Rh10 3PD, Crawley, West Sussex ',
  'Omaha',
  '643 Magazine Street Suite 206 , New Orleans, LA  70130',
  '330 A Street, San Diego, CA ',
  'Atlanta',
  'Denver',
  '72 Allen St 3rd Floor, New York, NY ',
  'Philadelphia',
  'Sydney',
  'Silicon Valley',
  'San Francisco',
  'London',
  'London',
  'Austin',
  'San Francisco',
  'Scottsdale',
  '641 Avenue of the Americas, New York, NY 10011',
  'Missoula',
  'Nairobi',
  'Singapore',
  'Silicon Valley',
  'New York',
  'Bali',
  '1624 Mike Fahey Street Suite 123, Omaha, NE 68102',
  'Tel Aviv',
  'Cape Town',
  '68 KH Road Double Rd Raja Ram Mohanroy Extension, Sudhama Nagar, , Bangalore,  ',
  'Bucharest',
  'Tampa',
  '150 Ottley Dr NE, Atlanta, GA 30324',
  'Dallas',
  'Shreveport',
  'Santa Teresa',
  'Berlin',
  'San Francisco',
  '483 Queen Street West 3rd floor, Toronto, ON M5V 2A9',
  'New York',
  'Montreal',
  '108 Pappajohn Business Building Suite S160, Iowa City, Iowa 52242',
  'Singapore',
  'Chicago',
  'Kansas City',
  '113 N San Vicente Blvd, Beverly Hills, CA 90211',
  '7757 West Flagler Street Suite 220, Miami, FL 33144',
  'Gainesville',
  'Bangalore',
  '2210 San Joaquin Street, Fresno, California 93721',
  'Silicon Valley',
  '11900 NE 1st St Suite 300, Bellevue, WA ',
  'Dublin',
  'Chicago',
  'Berlin',
  'Montreal',
  '312 Central Ave SE, Albuquerque, NM 87102',
  '1500 1st Avenue North, Birmingham, AL 35203',
  'Santiago',
  'Bogota',
  'Monterrey',
  'Wellington, New Zealand',
  'Dallas',
  'Dublin',
  'Tempe',
  'Chicago',
  'Los Angeles',
  'London',
  'Warsaw',
  'Dehli',
  '6720 Rolemodel Way Rolemodel Studios, Holly Springs, NC 27540',
  'Atlanta',
  'Mexico City',
  'Seattle',
  'Detroit',
  'Miami',
  'Los Angeles',
  'Chicago',
  'New York',
  '78 Alexander Street , Charleston, SC 29403',
  '1647 S. Blue Island Ave., Chicago, IL 60608',
  'Collins House, Rutland Square, Edinburgh, Scotland EH1 2AA',
  'Los Angeles',
  '1600 Range Street  Suite 100, Boulder, CO 80301',
  '1220 L Street NW Suite 100-513 , Washington, DC 20005',
  'Charlotte',
  '615 North Nash Street, El Segundo, CA ',
  '1111 Light Street  4th Floor , Baltimore, MD 21230',
  'Dallas',
  '800 Asilomar Ave, Pacific Grove, CA 93950',
  '205 Horseshoe Dam Road , Whitesburg, GA  30185',
  'Fayetteville',
  'Boise',
  '4900 Parkway Drive Suite 160, Mason, OH 45040',
  'Paris',
  '175 W Washington St, Chicago, IL 60602',
  'Bangalore',
  'Seattle',
  'Washington',
  'Boston',
  'Los Angeles',
  'Boston',
  'San Francisco',
  '108 Morris Street Suite 1B, Durham, NC 27701',
  'San Jose',
  '11600 Atlantis Place, Alpharetta, GA 30022',
  'Austin',
  'San Francisco',
  'New York',
  'San Diego',
  'Portland',
  'New York',
  'New York',
  'Modiin',
  'New York',
  'Lisbon',
  'San Francisco',
  'Los Angeles',
  'Level 2 162 Goulburn St, Surry Hills NSW,  2010',
  'Los Angeles',
  'St. Paul',
  '912 Congress Avenue, Austin, TX 78701',
  '333 North Plankinton Ave, Milwaukee, WI 53203',
  '4ta Ave "A" 13-66 Zona 14, Guatemala City,  ',
  '13331 Preston Road Suite 1160 , Dallas, TX ',
  'Costa Rica',
  'San Francisco',
  'Barcelona',
  '683 Sutter St. Suite 201, San Francisco, CA 94108',
  'San Francisco',
  'Sunnyvale',
  'Salt Lake City',
  'Provo',
  '735 SW 20th Pl. Suite 230, Portland, OR 97205',
  '515 Olive St #600, St. Louis,  MO 63101',
  'Kuwait City',
  'San Francisco',
  '14 Palmers Road , London,  E2 0SY',
  '6760 Jimmy Carter Blvd Norcross, Atlanta, GA 30071',
  'Irvine',
  '184 5th Avenue 4th Floor , New York, NY 10010 ',
  'Bangalore',
  'San Francisco',
  'Melbourne',
  'Sydney',
  'Brisbane',
  '1570 Woodward Avenue, Detroit, MI 48226',
  'London',
  '2800 Woodlawn Dr Suite 138, Honolulu, HI 96822',
  'Los Angeles',
  'Nashville',
  'New York',
  '379 N University Avenue #301, Provo, UT 84601',
  '5717 Arapahoe Ave #216 , Boulder, CO 80303',
  'Denver',
  'Obidos',
  'Porto',
  'Lisbon',
  '11 Broadway Suite 260, New York, NY 10004',
  '44 Tehama St, San Francisco, CA 94105',
  '1062 Delaware Street , Denver, Colorado 80204',
  '111 S Jackson St., Seattle, WA 98104 ',
  '242 Linden St., Fort Collins, CO 80524',
  '1035 Pearl Street  5th floor, Boulder, CO 80302',
  'New York',
  'Boston',
  'London',
  'Chicago',
  'Berlin',
  '160 Folsom St, San Francisco, CA 94105',
  '9th and Broadway, New York, NY ',
  '142 West Hastings Street, Vancouver, BC ',
  'Chicago',
  'St. Louis',
  'Jersey City',
  '340E 400S, Salt Lake City, UT 84111',
  '50-52 Commercial Street Floors 2 and 3, London,  E1 6LT',
  '223 W Erie, Chicago, IL 60654',
  '222 W Merchandise Mart Plaza  #1212, Chicago, IL 60654',
  'Chicago',
  'San Francisco',
  'Place Sainte-Gudule 5, Brussels,  1000 ',
  '25, rue du Petit Musc , Paris,  75004',
  '894 6th Ave, 5th Floor , New York, New York 10122',
  '30 South 17th Street, Philadelphia, PA  19103 ',
  '201 E. Jefferson St., Syracuse, NY ',
  'San Francisco',
  'New York',
  'Seattle',
  'San Francisco',
  'Boston',
  'Phoenix',
  '505 Montgomery Street  11th Floor , San Francisco, CA ',
  '701 Brazos St Suite 526, Austin, TX 78701',
  '33 Harrison Avenue, Boston, MA ',
  'Los Angeles',
  'Orange County',
  '9191 Sheridan Blvd, Westminster, CO 80031 ',
  'Oakland',
  'Silicon Valley',
  '445 King St. West, Toronto, ON ',
  '8201 164th Avenue Suite 105, Seattle, Washington 98166',
  '112 E Pecan St Suite 1000, San Antonio, TX 78205',
  '318 Cherokee Avenue SE Suite 104, Atlanta, GA 30312',
  'San Francisco',
  '351 West Hubbard St. Suite 701, Chicago, IL 60654',
  '717 California St., San Francisco, CA 94108',
  '599 Fairchild Dr., Mountain View, CA 94043',
  '175 Varick St., New York, NY 10013',
  '300 - 128 W. Hastings, Vancouver, BC V6B 1K6',
  '20 Duncan St, Toronto, ON M5H 3G6',
  '101 N. Main St. Suite 400, Greenville, SC 29601',
  'Crypt on The Green Clerkenwell Close, London,  EC1R 0EA',
  '5 Hanover Square Floor 25, New York, NY 10004',
  '25 Broadway, Manhattan, NY 10004',
  '156 2nd St, San Francisco, CA 94105 ',
  '944 Market St., San Francisco, CA 94103',
  'New York',
  'San Francisco',
  '9080 Irvine Center Dr, Irvine , CA 92618',
  '370 South 300 East, Salt Lake City, UT 84111',
  'Chicago',
  'DigitalCrafts Headquarters, 3405 Piedmont Road NE Suite 100, Atlanta, GA 30305',
  'Portland',
  '560 S. 100 W. , Provo, UT 84601',
  '120 S. Main Street , Salt Lake City, UT  84101',
  '211 N Ervay St, Dallas, Texas 75201',
  '400 NW 26th St, Miami , FL 33127',
  '310 SW 4th Ave Ste 230, Portland, OR 97204',
  'Madrid',
  'Barcelona',
  'Miami',
  '10777 Main St #100, Bellevue, WA 98004',
  '1980 Zanker Rd., San Jose, CA 95112',
  '1231 Shields Road Suite 5 , Kernersville, NC 27284',
  'Portland',
  'Seattle',
  'Chicago',
  'New York',
  'San Francisco',
  'Salt Lake City',
  'Miami',
  'Fort Lauderdale',
  'Tampa',
  'Austin',
  '902 Broadway 4th Floor, New York, NY 10010',
  '9 Back Hill, 4/F, London,  EC1R 5EN',
  '1520 2nd Street, Santa Monica, CA 90401',
  '414 Brannan Street, San Francisco, CA 94107',
  'The Hive, 21/F, The Phoenix, Luard Road No. 23, Wan Chai,  10013',
  '600 Congress Ave.  14th floor, Austin, TX  78701',
  'Level 1, 608 Harris St, Sydney, NSW 2007',
  '101 Main Street  14th Floor, Cambridge, MA 02142',
  'Denver',
  'Indianapolis',
  '526 Main Street, Akron, OH 44311',
  'New York' ];

var limiter = new Bottleneck(1, 500);

// getResultsPage(page, function(err, locations) {
// 	if(err) return console.log(err);
	console.log('NUMBER OF LOCATIONS = ', locations.length);
	async.mapLimit(
		locations,
		1,
		function(location, cb) {
			console.log(location);
			limiter.submit(geocoder.geocode.bind(geocoder), location, cb);
		},
		function(err, latLng) {
			if(err) return console.log(err);
			generateMap(latLng);
		}
	)
// });

function generateMap(latLngObjects) {
	// var latLngs = latLngObjects.filter(function(latLng) {
	// 	if(!latLng.length) return false;
	// 	if(!latLng[0].hasOwnProperty('latitude')) return false;
	// 	if(!latLng[0].hasOwnProperty('longitude')) return false;
	// 	return true;
	// });
	// latLngs = latLngs.map(function(latLng) {
	// 	console.log(latLng);
	// 	return {
	// 		lat: latLng[0].latitude,
	// 		lng: latLng[0].longitude
	// 	};
	// });
	var latLngs = [ { lat: 30.2870271, lng: -97.7291743 },
  { lat: 39.7390721, lng: -75.5397878 },
  { lat: 37.7888719, lng: -122.4115125 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: -1.2920659, lng: 36.8219462 },
  { lat: 17.385044, lng: 78.486671 },
  { lat: 43.6497773, lng: -79.3710728 },
  { lat: 30.1109904, lng: -81.77695 },
  { lat: 43.0389025, lng: -87.9064736 },
  { lat: 41.4629042, lng: -81.56553339999999 },
  { lat: 42.8782132, lng: -8.5448445 },
  { lat: -23.5505199, lng: -46.63330939999999 },
  { lat: 4.710988599999999, lng: -74.072092 },
  { lat: 44.977753, lng: -93.2650108 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 52.52000659999999, lng: 13.404954 },
  { lat: 40.2338438, lng: -111.6585337 },
  { lat: 51.5253459, lng: -0.1095716 },
  { lat: -33.8674869, lng: 151.2069902 },
  { lat: 42.48244520000001, lng: -71.1527116 },
  { lat: 52.3716753, lng: 4.916580199999999 },
  { lat: 44.8329326, lng: -93.3002813 },
  { lat: -8.4095178, lng: 115.188916 },
  { lat: 28.2915637, lng: -16.6291304 },
  { lat: 40.4862157, lng: -74.4518188 },
  { lat: 36.14305230000001, lng: -86.76727489999999 },
  { lat: 29.4241219, lng: -98.49362819999999 },
  { lat: 51.5073509, lng: -0.1277583 },
  { lat: 43.5445959, lng: -96.73110340000001 },
  { lat: 46.7712101, lng: 23.6236353 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: 39.7392358, lng: -104.990251 },
  { lat: 51.117737, lng: -0.1488279 },
  { lat: 41.2523634, lng: -95.99798829999999 },
  { lat: 29.9470483, lng: -90.0688361 },
  { lat: 32.7190865, lng: -117.1614064 },
  { lat: 33.7489954, lng: -84.3879824 },
  { lat: 39.7392358, lng: -104.990251 },
  { lat: 40.7175099, lng: -73.9909217 },
  { lat: 39.9525839, lng: -75.1652215 },
  { lat: -33.8674869, lng: 151.2069902 },
  { lat: 37.387474, lng: -122.0575434 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 51.5073509, lng: -0.1277583 },
  { lat: 51.5073509, lng: -0.1277583 },
  { lat: 30.267153, lng: -97.7430608 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 33.4941704, lng: -111.9260519 },
  { lat: 40.7407266, lng: -73.9948313 },
  { lat: 46.87871759999999, lng: -113.996586 },
  { lat: -1.2920659, lng: 36.8219462 },
  { lat: 1.352083, lng: 103.819836 },
  { lat: 37.387474, lng: -122.0575434 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: -8.4095178, lng: 115.188916 },
  { lat: 41.266165, lng: -95.938013 },
  { lat: 32.0852999, lng: 34.78176759999999 },
  { lat: -33.9248685, lng: 18.4240553 },
  { lat: 12.9655486, lng: 77.5942925 },
  { lat: 44.4267674, lng: 26.1025384 },
  { lat: 27.950575, lng: -82.4571776 },
  { lat: 33.807825, lng: -84.3831079 },
  { lat: 32.7766642, lng: -96.79698789999999 },
  { lat: 32.5251516, lng: -93.7501789 },
  { lat: 10.27085, lng: -66.70411969999999 },
  { lat: 52.52000659999999, lng: 13.404954 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 43.6483249, lng: -79.3978928 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: 45.5016889, lng: -73.567256 },
  { lat: 41.6631088, lng: -91.53492639999999 },
  { lat: 1.352083, lng: 103.819836 },
  { lat: 41.8781136, lng: -87.6297982 },
  { lat: 39.0997265, lng: -94.5785667 },
  { lat: 34.0657673, lng: -118.3735815 },
  { lat: 25.773884, lng: -80.3215982 },
  { lat: 29.6516344, lng: -82.32482619999999 },
  { lat: 12.9715987, lng: 77.5945627 },
  { lat: 36.7422463, lng: -119.7952302 },
  { lat: 37.387474, lng: -122.0575434 },
  { lat: 47.6114957, lng: -122.1826875 },
  { lat: 53.3498053, lng: -6.2603097 },
  { lat: 41.8781136, lng: -87.6297982 },
  { lat: 52.52000659999999, lng: 13.404954 },
  { lat: 45.5016889, lng: -73.567256 },
  { lat: 35.0833928, lng: -106.6440656 },
  { lat: 33.5118393, lng: -86.8125728 },
  { lat: 42.8782132, lng: -8.5448445 },
  { lat: 4.710988599999999, lng: -74.072092 },
  { lat: 25.6866142, lng: -100.3161126 },
  { lat: -41.2864603, lng: 174.776236 },
  { lat: 32.7766642, lng: -96.79698789999999 },
  { lat: 53.3498053, lng: -6.2603097 },
  { lat: 33.4255104, lng: -111.9400054 },
  { lat: 41.8781136, lng: -87.6297982 },
  { lat: 34.0522342, lng: -118.2436849 },
  { lat: 51.5073509, lng: -0.1277583 },
  { lat: 52.2296756, lng: 21.0122287 },
  { lat: 21.566381, lng: 73.2205065 },
  { lat: 35.6512655, lng: -78.8336218 },
  { lat: 33.7489954, lng: -84.3879824 },
  { lat: 19.4326077, lng: -99.133208 },
  { lat: 47.6062095, lng: -122.3320708 },
  { lat: 42.331427, lng: -83.0457538 },
  { lat: 25.7616798, lng: -80.1917902 },
  { lat: 34.0522342, lng: -118.2436849 },
  { lat: 41.8781136, lng: -87.6297982 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: 32.7886278, lng: -79.93028799999999 },
  { lat: 41.8584079, lng: -87.66032589999999 },
  { lat: 55.9490615, lng: -3.2090077 },
  { lat: 34.0522342, lng: -118.2436849 },
  { lat: 40.015123, lng: -105.229601 },
  { lat: 38.9033549, lng: -77.02905609999999 },
  { lat: 35.2270869, lng: -80.8431267 },
  { lat: 33.925308, lng: -118.387856 },
  { lat: 39.276763, lng: -76.6120158 },
  { lat: 32.7766642, lng: -96.79698789999999 },
  { lat: 36.6189641, lng: -121.9377473 },
  { lat: 33.53040500000001, lng: -84.92359599999999 },
  { lat: 35.0526641, lng: -78.87835849999999 },
  { lat: 43.6187102, lng: -116.2146068 },
  { lat: 39.3036659, lng: -84.31321899999999 },
  { lat: 48.856614, lng: 2.3522219 },
  { lat: 41.883008, lng: -87.6333356 },
  { lat: 12.9715987, lng: 77.5945627 },
  { lat: 47.6062095, lng: -122.3320708 },
  { lat: 38.9071923, lng: -77.0368707 },
  { lat: 42.3600825, lng: -71.0588801 },
  { lat: 34.0522342, lng: -118.2436849 },
  { lat: 42.3600825, lng: -71.0588801 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 35.997267, lng: -78.90357600000002 },
  { lat: 37.3382082, lng: -121.8863286 },
  { lat: 34.0490192, lng: -84.2753097 },
  { lat: 30.267153, lng: -97.7430608 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: 32.715738, lng: -117.1610838 },
  { lat: 45.5230622, lng: -122.6764816 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: 31.90912, lng: 35.002462 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: 38.7222524, lng: -9.1393366 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 34.0522342, lng: -118.2436849 },
  { lat: -33.8787943, lng: 151.2121762 },
  { lat: 34.0522342, lng: -118.2436849 },
  { lat: 44.9537029, lng: -93.0899578 },
  { lat: 30.2714598, lng: -97.741948 },
  { lat: 43.0342862, lng: -87.9117971 },
  { lat: 14.5823167, lng: -90.5040193 },
  { lat: 32.9295552, lng: -96.8077503 },
  { lat: 9.748916999999999, lng: -83.753428 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 41.3850639, lng: 2.1734035 },
  { lat: 37.7888719, lng: -122.4115125 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 37.36883, lng: -122.0363496 },
  { lat: 40.7607793, lng: -111.8910474 },
  { lat: 40.2338438, lng: -111.6585337 },
  { lat: 45.5224465, lng: -122.6936584 },
  { lat: 38.628183, lng: -90.189745 },
  { lat: 29.375859, lng: 47.9774052 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 51.5295318, lng: -0.0422949 },
  { lat: 33.919087, lng: -84.20949000000002 },
  { lat: 33.6839473, lng: -117.7946942 },
  { lat: 40.741444, lng: -73.99007 },
  { lat: 12.9715987, lng: 77.5945627 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 28.0836269, lng: -80.60810889999999 },
  { lat: -33.8674869, lng: 151.2069902 },
  { lat: -27.4710107, lng: 153.0234489 },
  { lat: 42.3358794, lng: -83.0497453 },
  { lat: 51.5073509, lng: -0.1277583 },
  { lat: 21.3088603, lng: -157.8085824 },
  { lat: 34.0522342, lng: -118.2436849 },
  { lat: 36.1626638, lng: -86.7816016 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: 40.2387147, lng: -111.6590795 },
  { lat: 40.0174283, lng: -105.2203292 },
  { lat: 39.7392358, lng: -104.990251 },
  { lat: 39.3604212, lng: -9.1582014 },
  { lat: 41.1579438, lng: -8.629105299999999 },
  { lat: 38.7222524, lng: -9.1393366 },
  { lat: 40.705329, lng: -74.0139696 },
  { lat: 37.7874944, lng: -122.3965335 },
  { lat: 39.733536, lng: -104.992611 },
  { lat: 47.5990533, lng: -122.3336944 },
  { lat: 40.588476, lng: -105.074212 },
  { lat: 40.0177185, lng: -105.2819596 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: 42.3600825, lng: -71.0588801 },
  { lat: 51.5073509, lng: -0.1277583 },
  { lat: 41.8781136, lng: -87.6297982 },
  { lat: 52.52000659999999, lng: 13.404954 },
  { lat: 37.7897374, lng: -122.3917544 },
  { lat: 40.7311726, lng: -73.9919268 },
  { lat: 49.28215850000001, lng: -123.1086794 },
  { lat: 41.8781136, lng: -87.6297982 },
  { lat: 38.6270025, lng: -90.19940419999999 },
  { lat: 40.72815749999999, lng: -74.0776417 },
  { lat: 40.760246, lng: -111.880999 },
  { lat: 51.5174603, lng: -0.0732902 },
  { lat: 41.89374, lng: -87.63533 },
  { lat: 41.8885185, lng: -87.63548019999999 },
  { lat: 41.8781136, lng: -87.6297982 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 50.84744329999999, lng: 4.3591849 },
  { lat: 48.8528847, lng: 2.3643089 },
  { lat: 40.7485964, lng: -73.9883188 },
  { lat: 39.9525152, lng: -75.1689483 },
  { lat: 43.0471862, lng: -76.1504376 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: 47.6062095, lng: -122.3320708 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 42.3600825, lng: -71.0588801 },
  { lat: 33.4483771, lng: -112.0740373 },
  { lat: 37.7938693, lng: -122.4033285 },
  { lat: 30.2686062, lng: -97.7404665 },
  { lat: 42.3515662, lng: -71.0613815 },
  { lat: 34.0522342, lng: -118.2436849 },
  { lat: 33.7174708, lng: -117.8311428 },
  { lat: 39.86304030000001, lng: -105.0538696 },
  { lat: 37.8043637, lng: -122.2711137 },
  { lat: 37.387474, lng: -122.0575434 },
  { lat: 43.6450128, lng: -79.3958526 },
  { lat: 47.4560563, lng: -122.3417576 },
  { lat: 29.4284595, lng: -98.49243299999999 },
  { lat: 33.7462575, lng: -84.3732296 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 41.8897167, lng: -87.6376107 },
  { lat: 37.79221, lng: -122.406141 },
  { lat: 37.4029365, lng: -122.0499433 },
  { lat: 40.7274081, lng: -74.00576869999999 },
  { lat: 49.2818872, lng: -123.1081878 },
  { lat: 43.6479337, lng: -79.38882319999999 },
  { lat: 34.8518567, lng: -82.3999645 },
  { lat: 51.523239, lng: -0.1054999 },
  { lat: 40.7050758, lng: -74.0091604 },
  { lat: 40.70556029999999, lng: -74.0139587 },
  { lat: 37.7871905, lng: -122.3990266 },
  { lat: 37.7835565, lng: -122.4086788 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 33.6362183, lng: -117.7394721 },
  { lat: 40.760986, lng: -111.882878 },
  { lat: 41.8781136, lng: -87.6297982 },
  { lat: 33.8481499, lng: -84.372701 },
  { lat: 45.5230622, lng: -122.6764816 },
  { lat: 40.2262942, lng: -111.6607763 },
  { lat: 40.766562, lng: -111.89159 },
  { lat: 32.782182, lng: -96.79759999999999 },
  { lat: 25.8011523, lng: -80.2022413 },
  { lat: 45.5208482, lng: -122.6746711 },
  { lat: 40.4167754, lng: -3.7037902 },
  { lat: 41.3850639, lng: 2.1734035 },
  { lat: 25.7616798, lng: -80.1917902 },
  { lat: 47.609809, lng: -122.1965031 },
  { lat: 37.3768183, lng: -121.912378 },
  { lat: 36.0968103, lng: -80.0721707 },
  { lat: 45.5230622, lng: -122.6764816 },
  { lat: 47.6062095, lng: -122.3320708 },
  { lat: 41.8781136, lng: -87.6297982 },
  { lat: 40.7127837, lng: -74.0059413 },
  { lat: 37.7749295, lng: -122.4194155 },
  { lat: 40.7607793, lng: -111.8910474 },
  { lat: 25.7616798, lng: -80.1917902 },
  { lat: 26.1224386, lng: -80.13731740000001 },
  { lat: 27.950575, lng: -82.4571776 },
  { lat: 30.267153, lng: -97.7430608 },
  { lat: 40.7393083, lng: -73.9894285 },
  { lat: 51.5225339, lng: -0.1094356 },
  { lat: 34.0129821, lng: -118.495196 },
  { lat: 37.7798936, lng: -122.394879 },
  { lat: 40.7217861, lng: -74.0094471 },
  { lat: 30.26861199999999, lng: -97.7431067 },
  { lat: -33.8804496, lng: 151.2003679 },
  { lat: 42.3622387, lng: -71.0816306 },
  { lat: 39.7392358, lng: -104.990251 },
  { lat: 39.768403, lng: -86.158068 },
  { lat: 41.07199079999999, lng: -81.52692619999999 },
  { lat: 40.7127837, lng: -74.0059413 } ];
	console.log('NUMBER OF COORDINATES = ', latLngs.length);
	console.log(latLngs);
}



function getResultsPage(page, cb) {
	console.log('Getting results for '+page);
	request(urlBase+search+page, function(error, response, html) {
		if(error) return cb(error);
		var $ = cheerio.load(html);
		if($('.no-schools').length) return cb(null, []);

		var urls = [];
		$('.school-header > h3 > a').each(function(i, $el) {
			urls.push(urlBase + $(this).attr('href'));
		});

		async.map(
			urls,
			getAddressFromSchool,
			function(err, result) {
				if(err) return cb(err);
				// allLocations.concat(_.flatten(result));
				getResultsPage(++page, function(err, results) {
					cb(err, results.concat(_.flatten(result)));
				});
			}
		);
	});
}

function getAddressFromSchool(url, cb) {
	request(url, function(error, response, html) {
		if(error) return cb(error);
		var $ = cheerio.load(html);
		var addresses = [];
		var $locations = $('.campus .subtitle span:nth-child(2)');
		if(!$locations.length) {
			$locations = $('.school-info .location a');
		}
		$locations.each(function(i, $el) {
			var a = $(this).text();
			if(a.toLowerCase() === 'online') return;
			addresses.push(a);
		});
		cb(null, addresses);
	});
}